LABEL_COLUMNS = ['baseColour_Beige', 'baseColour_Black', 'baseColour_Blue', 'baseColour_Bronze', 'baseColour_Brown', 
                 'baseColour_Burgundy', 'baseColour_Charcoal', 'baseColour_Coffee Brown', 'baseColour_Copper', 'baseColour_Cream', 
                 'baseColour_Fluorescent Green', 'baseColour_Gold', 'baseColour_Green', 'baseColour_Grey', 
                 'baseColour_Grey Melange', 'baseColour_Khaki', 'baseColour_Lavender', 'baseColour_Lime Green', 
                 'baseColour_Magenta', 'baseColour_Maroon', 'baseColour_Mauve', 'baseColour_Metallic', 'baseColour_Multi', 
                 'baseColour_Mushroom Brown', 'baseColour_Mustard', 'baseColour_Navy Blue', 'baseColour_Nude', 
                 'baseColour_Off White', 'baseColour_Olive', 'baseColour_Orange', 'baseColour_Peach', 'baseColour_Pink',
                   'baseColour_Purple', 'baseColour_Red', 'baseColour_Rose', 'baseColour_Rust', 'baseColour_Sea Green',
                  'baseColour_Silver', 'baseColour_Skin', 'baseColour_Steel', 'baseColour_Tan', 'baseColour_Taupe',
                  'baseColour_Teal', 'baseColour_Turquoise Blue', 'baseColour_White', 'baseColour_Yellow',
                  'articleType_Accessory Gift Set', 'articleType_Baby Dolls', 'articleType_Backpacks', 'articleType_Bangle',
                    'articleType_Basketballs', 'articleType_Bath Robe', 'articleType_Beauty Accessory', 'articleType_Belts', 
                    'articleType_Blazers', 'articleType_Body Lotion', 'articleType_Body Wash and Scrub',
                      'articleType_Booties', 'articleType_Boxers', 'articleType_Bra', 'articleType_Bracelet',
                    'articleType_Briefs', 'articleType_Camisoles', 'articleType_Capris', 'articleType_Caps', 
                      'articleType_Casual Shoes', 'articleType_Churidar', 'articleType_Clothing Set',
                     'articleType_Clutches', 'articleType_Compact', 'articleType_Concealer', 'articleType_Cufflinks', 
                      'articleType_Cushion Covers', 'articleType_Deodorant', 'articleType_Dresses', 
                      'articleType_Duffel Bag', 'articleType_Dupatta', 'articleType_Earrings',
                      'articleType_Eye Cream', 'articleType_Eyeshadow', 'articleType_Face Moisturisers',
                      'articleType_Face Scrub and Exfoliator', 'articleType_Face Serum and Gel', 
                      'articleType_Face Wash and Cleanser', 'articleType_Flats', 'articleType_Flip Flops', 
                      'articleType_Footballs', 'articleType_Formal Shoes', 'articleType_Foundation and Primer', 
                      'articleType_Fragrance Gift Set', 'articleType_Free Gifts', 'articleType_Gloves',
                        'articleType_Hair Accessory', 'articleType_Hair Colour', 'articleType_Handbags', 
                        'articleType_Hat', 'articleType_Headband', 'articleType_Heels', 
                          'articleType_Highlighter and Blush', 'articleType_Innerwear Vests', 
                          'articleType_Ipad', 'articleType_Jackets', 'articleType_Jeans', 'articleType_Jeggings',
                          'articleType_Jewellery Set', 'articleType_Jumpsuit', 'articleType_Kajal and Eyeliner', 
                        'articleType_Key chain', 'articleType_Kurta Sets', 'articleType_Kurtas',
                        'articleType_Kurtis', 'articleType_Laptop Bag', 'articleType_Leggings', 
                        'articleType_Lehenga Choli', 'articleType_Lip Care', 'articleType_Lip Gloss', 
                        'articleType_Lip Liner', 'articleType_Lip Plumper', 'articleType_Lipstick', 'articleType_Lounge Pants', 
                        'articleType_Lounge Shorts', 'articleType_Lounge Tshirts', 'articleType_Makeup Remover', 
                        'articleType_Mascara', 'articleType_Mask and Peel', 'articleType_Mens Grooming Kit', 
                        'articleType_Messenger Bag', 'articleType_Mobile Pouch', 'articleType_Mufflers', 
                        'articleType_Nail Essentials', 'articleType_Nail Polish', 'articleType_Necklace and Chains', 
                        'articleType_Nehru Jackets', 'articleType_Night suits', 'articleType_Nightdress', 'articleType_Patiala', 
                        'articleType_Pendant', 'articleType_Perfume and Body Mist', 'articleType_Rain Jacket', 
                        'articleType_Rain Trousers', 'articleType_Ring', 'articleType_Robe', 'articleType_Rompers', 
                        'articleType_Rucksacks', 'articleType_Salwar', 'articleType_Salwar and Dupatta', 'articleType_Sandals', 
                        'articleType_Sarees', 'articleType_Scarves', 'articleType_Shapewear', 'articleType_Shirts', 
                        'articleType_Shoe Accessories', 'articleType_Shoe Laces', 'articleType_Shorts', 'articleType_Shrug', 
                        'articleType_Skirts', 'articleType_Socks', 'articleType_Sports Sandals', 'articleType_Sports Shoes', 
                        'articleType_Stockings', 'articleType_Stoles', 'articleType_Suits', 'articleType_Sunglasses', 
                        'articleType_Sunscreen', 'articleType_Suspenders', 'articleType_Sweaters', 'articleType_Sweatshirts', 
                        'articleType_Swimwear', 'articleType_Tablet Sleeve', 'articleType_Ties', 'articleType_Ties and Cufflinks', 
                        'articleType_Tights', 'articleType_Toner', 'articleType_Tops', 'articleType_Track Pants', 
                        'articleType_Tracksuits', 'articleType_Travel Accessory', 'articleType_Trolley Bag', 'articleType_Trousers', 
                        'articleType_Trunk', 'articleType_Tshirts', 'articleType_Tunics', 'articleType_Umbrellas', 
                        'articleType_Waist Pouch', 'articleType_Waistcoat', 'articleType_Wallets', 'articleType_Watches', 
                        'articleType_Water Bottle', 'articleType_Wristbands', 'season_Fall', 'season_Spring', 'season_Summer', 
                        'season_Winter', 'gender_Boys', 'gender_Girls', 'gender_Men', 'gender_Unisex', 'gender_Women']  # Update with actual labels
import streamlit as st
import numpy as np
from tensorflow.keras.preprocessing import image
from tensorflow.keras.models import load_model
from tensorflow.keras.applications import EfficientNetB0  # If using EfficientNet

# Load the trained model
@st.cache_resource()
def load_trained_model():
    return load_model("final_model.keras")  # Update path if needed

model = load_trained_model()

# Ensure the model has the correct structure
st.write(f"Model Input Shape: {model.input_shape}")  # Debugging step

def predict_image(img_path, model, label_columns):
    # Load and preprocess the image
    img = image.load_img(img_path, target_size=(128,128))  # Match input size
    img_array = image.img_to_array(img) / 255.0  # Normalize
    img_array = np.expand_dims(img_array, axis=0)  # Add batch dimension

 
    # Get predictions
    preds = model.predict(img_array)[0]  # Remove batch dimension
    
    lst = preds  

    # Use list slicing to split the list
    list1 = lst[:46]           # First 46 elements
    list2 = lst[46:46+143]     # Next 143 elements
    list3 = lst[46+143:46+143+4]  # Next 4 elements
    list4 = lst[46+143+4:46+143+4+5]  # Next 5 elements

    # Find max values in each slice
    max1 = max(list1)
    max2 = max(list2)
    max3 = max(list3)
    max4 = max(list4)

    # Convert to NumPy indices to get correct positions
    max1_idx = np.where(lst == max1)[0][0]
    max2_idx = np.where(lst == max2)[0][0]
    max3_idx = np.where(lst == max3)[0][0]
    max4_idx = np.where(lst == max4)[0][0]

    
    

    # Get corresponding labels
    plabel = [label_columns[max1_idx], label_columns[max2_idx], label_columns[max3_idx], label_columns[max4_idx]]


    
    return plabel

# Streamlit UI
st.title("Image Classification Predictor")

uploaded_file = st.file_uploader("Upload an Image", type=["jpg", "png", "jpeg"])

if uploaded_file is not None:
    img = "temp.jpg"
    with open(img, "wb") as f:
        f.write(uploaded_file.getbuffer())
st.image(img, caption="Uploaded Image", use_container_width=True)


if st.button("Predict"):
    predicted_labels = predict_image(img, model, LABEL_COLUMNS)
    if predicted_labels:
        st.success(f"Predicted Labels: {predicted_labels}")
